# H∆Ø·ªöNG D·∫™N TR√çCH XU·∫§T GIA PH·∫¢ T·ª™ HTML

**Python + BeautifulSoup ‚Üí Schema chu·∫©n**

---

## 1. M·ª•c ti√™u

Tr√≠ch xu·∫•t th√¥ng tin **Gia ph·∫£ + Th·ªßy t·ªï** t·ª´ c√°c trang HTML c·ªï (table-based, font tag, kh√¥ng semantic) v√† chu·∫©n h√≥a th√†nh JSON theo schema:

```json
{
  "name": "string",
  "code": "string",
  "description": "string",
  "address": "string",
  "genealogyRecord": "string",
  "progenitorName": "string",
  "familyCovenant": "string",
  "contactInfo": "string",
  "avatarBase64": "string",
  "visibility": "Private",
  "managerIds": [],
  "viewerIds": [],
  "locationId": ""
}
```

---

## 2. Ph√¢n t√≠ch ngu·ªìn HTML

### 2.1 HTML 1 ‚Äì Trang **T·ªïng quan gia ph·∫£**

Ngu·ªìn ch√≠nh ƒë·ªÉ l·∫•y:

* T√™n gia ph·∫£
* Chi h·ªç
* ƒê·ªãa danh
* T·ªïng quan (s·ªë ƒë·ªùi, s·ªë ng∆∞·ªùi‚Ä¶)
* Th√¥ng tin ng∆∞·ªùi qu·∫£n l√Ω

üëâ HTML **kh√¥ng c√≥ class/id**, n√™n ph·∫£i:

* D·ª±a v√†o **text ti·∫øng Vi·ªát**
* Duy·ªát `<li>`, `<font>`, `<div>`

---

### 2.2 HTML 2 ‚Äì Trang **Th·ªßy t·ªï**

Ngu·ªìn ch√≠nh ƒë·ªÉ l·∫•y:

* T√™n th·ªßy t·ªï
* Ti·ªÉu s·ª≠ chi ti·∫øt (r·∫•t d√†i)
* C√≥ th·ªÉ d√πng l√†m **genealogyRecord** ho·∫∑c **description**

üëâ N·ªôi dung n·∫±m trong:

```html
<td><div align="justify"> ... </div></td>
```

---

## 3. Chi·∫øn l∆∞·ª£c tr√≠ch xu·∫•t (QUAN TR·ªåNG)

### Nguy√™n t·∫Øc

1. **Kh√¥ng ph·ª• thu·ªôc c·∫•u tr√∫c table**
2. ∆Øu ti√™n:

   * `get_text(strip=True)`
   * T√¨m theo **keyword ti·∫øng Vi·ªát**
3. Lu√¥n normalize text:

   * Remove `\xa0`
   * G·ªôp kho·∫£ng tr·∫Øng
4. HTML c·ªï ‚Üí **ƒë·ª´ng d√πng CSS selector ph·ª©c t·∫°p**

---

## 4. Mapping d·ªØ li·ªáu ‚Üí Schema

| Schema field      | Ngu·ªìn   | C√°ch tr√≠ch                               |
| ----------------- | ------- | ---------------------------------------- |
| `name`            | HTML 1  | "GIA PH·∫¢ T·ªòC Chi h·ªç ‚Ä¶"                   |
| `code`            | HTML 1  | Slug h√≥a t√™n                             |
| `description`     | HTML 1  | L·ªùi n√≥i ti√™u bi·ªÉu                        |
| `address`         | HTML 1  | ƒêo·∫°n ‚Äú·ªû t·∫°i ‚Ä¶‚Äù                           |
| `genealogyRecord` | HTML 2  | To√†n b·ªô n·ªôi dung Th·ªßy t·ªï                 |
| `progenitorName`  | HTML 2  | ‚ÄúC·ª§ T·ªî ‚Ä¶‚Äù                                |
| `familyCovenant`  | HTML 2  | N·∫øu c√≥ trang T·ªôc ∆Ø·ªõc (ch∆∞a c√≥ ‚Üí ƒë·ªÉ r·ªóng) |
| `contactInfo`     | HTML 1  | Ng∆∞·ªùi l√†m, ƒë·ªãa ch·ªâ, ƒëi·ªán tho·∫°i, email    |
| `avatarBase64`    | ‚Äî       | null / ""                                |
| `visibility`      | default | `"Private"`                              |

---

## 5. Code Python ‚Äì Tr√≠ch xu·∫•t HTML 1 (T·ªïng quan)

```python
from bs4 import BeautifulSoup
import re

def clean_text(text: str) -> str:
    return re.sub(r"\s+", " ", text.replace("\xa0", " ")).strip()

def extract_overview(html: str) -> dict:
    soup = BeautifulSoup(html, "html.parser")
    text = soup.get_text("\n")

    result = {}

    # NAME
    for line in text.splitlines():
        if "GIA PH·∫¢" in line and "Chi h·ªç" in line:
            result["name"] = clean_text(line)
            break

    # DESCRIPTION (l·ªùi n√≥i ti√™u bi·ªÉu)
    m = re.search(r"L·ªùi n√≥i ti√™u bi·ªÉu c·ªßa h·ªçc t·ªôc\s+(.*)", text)
    if m:
        result["description"] = clean_text(m.group(1))

    # ADDRESS
    m = re.search(r"Th√¥n.*?t·ªânh.*", text)
    if m:
        result["address"] = clean_text(m.group(0))

    # CONTACT INFO
    contact_lines = []
    for li in soup.find_all("li"):
        if any(k in li.get_text() for k in ["Ng∆∞·ªùi l√†m", "ƒê·ªãa ch·ªâ", "ƒêi·ªán tho·∫°i", "Email"]):
            contact_lines.append(clean_text(li.get_text()))

    result["contactInfo"] = " | ".join(contact_lines)

    return result
```

---

## 6. Code Python ‚Äì Tr√≠ch xu·∫•t HTML 2 (Th·ªßy t·ªï)

```python
def extract_progenitor(html: str) -> dict:
    soup = BeautifulSoup(html, "html.parser")

    content_div = soup.find("div", align="justify")
    if not content_div:
        return {}

    full_text = clean_text(content_div.get_text("\n"))

    result = {}
    result["genealogyRecord"] = full_text

    # PROGENITOR NAME
    m = re.search(r"C·ª§ T·ªî\s+([A-Zƒê\s]+)", full_text)
    if m:
        result["progenitorName"] = clean_text(m.group(1))

    return result
```

---

## 7. Gh√©p d·ªØ li·ªáu ‚Üí Schema ho√†n ch·ªânh

```python
def build_schema(overview: dict, progenitor: dict) -> dict:
    return {
        "name": overview.get("name", ""),
        "code": re.sub(r"\s+", "-", overview.get("name", "").lower()),
        "description": overview.get("description", ""),
        "address": overview.get("address", ""),
        "genealogyRecord": progenitor.get("genealogyRecord", ""),
        "progenitorName": progenitor.get("progenitorName", ""),
        "familyCovenant": "",
        "contactInfo": overview.get("contactInfo", ""),
        "avatarBase64": "",
        "visibility": "Private",
        "managerIds": [],
        "viewerIds": [],
        "locationId": ""
    }
```

---

## 8. Output JSON m·∫´u

```json
{
  "name": "GIA PH·∫¢ T·ªòC Chi h·ªç Cao Minh Tri·∫øt - H∆∞ng Y√™n",
  "code": "gia-pha-toc-chi-ho-cao-minh-triet-hung-yen",
  "description": "ƒê√≥i cho s·∫°ch, r√°ch cho th∆°m",
  "address": "Th√¥n Tam K·ª≥ - L√†ng Xu√¢n C·∫ßu - x√£ Nghƒ©a Tr·ª• - t·ªânh H∆∞ng Y√™n",
  "genealogyRecord": "C·ª§ T·ªî CAO MINH TRI·∫æT sinh nƒÉm 1836 ...",
  "progenitorName": "CAO MINH TRI·∫æT",
  "familyCovenant": "",
  "contactInfo": "Ng∆∞·ªùi l√†m: √îng Cao Tu·∫•n Long | ƒê·ªãa ch·ªâ: 402D6DichVong | ƒêi·ªán tho·∫°i: 0983842070 | Email: Caotuanlong@gmail.com",
  "avatarBase64": "",
  "visibility": "Private",
  "managerIds": [],
  "viewerIds": [],
  "locationId": ""
}
```

---